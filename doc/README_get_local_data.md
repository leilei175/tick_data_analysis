# get_local_data 函数使用文档

## 1. 函数概述

`get_local_data` 是一个用于读取本地日频 parquet 数据的函数，支持按股票列表、日期范围和字段进行灵活查询。

## 2. 函数签名

```python
def get_local_data(
    sec_list: Union[List[str], None] = None,
    start: Optional[str] = None,
    end: Optional[str] = None,
    filed: str = 'close'
) -> pd.DataFrame
```

## 3. 参数说明

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `sec_list` | List[str] or None | None | 股票代码列表，如 `['000001.SZ', '000002.SZ']`。None 表示获取所有股票 |
| `start` | str or None | None | 开始日期，格式 `'YYYYMMDD'`，例如 `'20250101'` |
| `end` | str or None | None | 结束日期，格式 `'YYYYMMDD'`，例如 `'20251231'` |
| `filed` | str | 'close' | 要获取的字段名，支持的字段包括：`open`, `high`, `low`, `close`, `pre_close`, `change`, `pct_chg`, `vol`, `amount` |

## 4. 返回值

返回一个 pandas DataFrame：

- **index**: 日期 (DatetimeIndex)
- **columns**: 股票代码
- **values**: 指定字段的数值

## 5. 使用示例

### 5.1 获取单只股票的收盘价

```python
from get_local_data import get_local_data

# 获取 000001.SZ 2025年全年的收盘价
df = get_local_data(
    sec_list=['000001.SZ'],
    start='20250101',
    end='20251231',
    filed='close'
)
print(df.head())
```

### 5.2 获取多只股票的收盘价

```python
# 获取多只股票2025年1月的收盘价
sec_list = ['000001.SZ', '000002.SZ', '600000.SH', '000004.SZ']
df = get_local_data(
    sec_list=sec_list,
    start='20250101',
    end='20250131',
    filed='close'
)
```

### 5.3 获取所有股票的某一字段

```python
# 获取所有股票2025年1月2日的收盘价
df = get_local_data(
    sec_list=None,  # 不指定股票列表，获取所有
    start='20250102',
    end='20250102',
    filed='close'
)
```

### 5.4 获取其他字段

```python
# 获取股票的成交量
df = get_local_data(
    sec_list=['000001.SZ'],
    start='20250101',
    end='20250131',
    filed='vol'
)

# 获取涨跌幅
df = get_local_data(
    sec_list=['000001.SZ'],
    start='20250101',
    end='20250131',
    filed='pct_chg'
)
```

## 6. 数据格式

### 输入数据格式

函数读取目录下符合 `daily_YYYYMMDD.parquet` 格式的 parquet 文件。

单文件数据结构示例：

```
     ts_code trade_date   open   high    low  close  pre_close  change  pct_chg        vol       amount
0  000001.SZ   20250102  11.73  11.77  11.36  11.43      11.70   -0.27   -2.3077  1819596.99  2102923.078
1  000002.SZ   20250102   7.25   7.36   7.10   7.11       7.26   -0.15   -2.0661  1182666.05   854487.563
...
```

### 输出数据格式

```
                    000001.SZ  000002.SZ  000004.SZ
date
2025-01-02              11.43       7.11      13.66
2025-01-03              11.38       7.00      13.85
2025-01-06              11.44       6.98      14.20
...
```

## 7. 性能测试结果

### 7.1 测试环境

- 数据目录包含约 244 个日频 parquet 文件
- 每文件约 270KB-300KB
- 测试时间范围：2025年1月1日 - 2025年12月31日

### 7.2 性能测试数据

| 测试场景 | 耗时 (秒) | 内存峰值 (MB) | 数据形状 |
|---------|----------|--------------|----------|
| 1只股票_1天 | 0.013 | 1.16 | (1, 1) |
| 1只股票_1个月 | 0.134 | 78.10 | (19, 1) |
| 1只股票_1年 | 0.721 | 203.42 | (244, 1) |
| 10只股票_1天 | 0.007 | 0.56 | (1, 8) |
| 10只股票_1个月 | 0.131 | 78.14 | (19, 8) |
| 10只股票_1年 | 0.668 | 203.47 | (244, 8) |
| 100只股票_1天 | 0.009 | 0.56 | (1, 54) |
| 100只股票_1个月 | 0.126 | 78.66 | (19, 55) |
| 100只股票_1年 | 0.656 | 204.37 | (244, 55) |
| 1000只股票_1天 | 0.009 | 0.57 | (1, 416) |
| 1000只股票_1个月 | 0.130 | 82.70 | (19, 419) |
| 1000只股票_1年 | 0.673 | 211.63 | (244, 419) |
| 5000只股票_1天 | 0.009 | 0.68 | (1, 1472) |
| 5000只股票_1个月 | 0.148 | 94.62 | (19, 1498) |
| 5000只股票_1年 | 0.736 | 232.90 | (244, 1498) |

### 7.3 性能分析

1. **时间复杂度**：
   - 日期范围是主要的时间消耗因素
   - 股票数量对耗时影响较小（因为 parquet 列式存储的特性）

2. **内存占用**：
   - 与日期范围正相关
   - 1年数据约 200-230 MB（峰值）
   - 1个月数据约 78-95 MB

3. **优化建议**：
   - 大批量数据查询时，建议分批处理
   - 优先筛选日期范围，再筛选股票列表

## 8. 注意事项

1. **股票代码格式**：请使用标准的 Tushare 格式，如 `'000001.SZ'`（深圳）、`'600000.SH'`（上海）

2. **日期格式**：必须为字符串格式 `'YYYYMMDD'`，例如 `'20250101'`

3. **数据完整性**：如果指定的股票在某些交易日没有数据（如停牌），结果中该日期对应值为 NaN

4. **文件过滤**：函数会自动排除汇总文件（如 `daily_20250101_20260208.parquet`），只读取单日文件

5. **性能优化**：
   - 使用 pyarrow 直接读取指定列，减少 IO
   - 按文件名过滤日期范围，避免读取不需要的文件
