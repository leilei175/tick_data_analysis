# get_local_data 函数使用文档

## 1. 函数概述

`get_local_data` 是一个用于读取本地日频 parquet 数据的函数，支持按股票列表、日期范围和字段进行灵活查询。

## 2. 函数签名

```python
def get_local_data(
    sec_list: Union[List[str], None] = None,
    start: Optional[str] = None,
    end: Optional[str] = None,
    filed: str = 'close',
    data_dir: str = '.'
) -> pd.DataFrame
```

## 3. 参数说明

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `sec_list` | List[str] or None | None | 股票代码列表，如 `['000001.SZ', '000002.SZ']`。None 表示获取所有股票 |
| `start` | str or None | None | 开始日期，格式 `'YYYYMMDD'`，例如 `'20250101'` |
| `end` | str or None | None | 结束日期，格式 `'YYYYMMDD'`，例如 `'20251231'` |
| `filed` | str | 'close' | 要获取的字段名，支持：`open`, `high`, `low`, `close`, `pre_close`, `change`, `pct_chg`, `vol`, `amount` |
| `data_dir` | str | '.' | 数据目录路径，默认为当前目录 |

## 4. 返回值

返回一个 pandas DataFrame：

- **index**: 日期 (DatetimeIndex)
- **columns**: 股票代码
- **values**: 指定字段的数值

## 5. 使用示例

### 5.1 基本用法

```python
from mylib.get_local_data import get_local_data

# 从当前目录读取数据
df = get_local_data(
    sec_list=['000001.SZ'],
    start='20250101',
    end='20251231',
    filed='close'
)
```

### 5.2 指定数据目录

```python
# 从指定目录读取数据
df = get_local_data(
    sec_list=['000001.SZ', '600000.SH'],
    start='20250101',
    end='20250131',
    filed='close',
    data_dir='../data/daily'
)
```

### 5.3 获取所有股票

```python
# 获取所有股票某天的收盘价
df = get_local_data(
    sec_list=None,
    start='20250102',
    end='20250102',
    filed='close',
    data_dir='../data'
)
```

## 6. 性能测试结果

### 6.1 测试环境

- 数据目录包含 244 个日频 parquet 文件
- 全量股票数量：5511 只
- 每文件约 270KB-300KB

### 6.2 性能测试数据

| 测试场景 | 耗时 (秒) | 内存峰值 (MB) | 数据形状 |
|---------|----------|--------------|----------|
| 1只股票_1天 | 0.008 | 0.65 | (1, 1) |
| 1只股票_1个月 | 0.108 | 78.10 | (19, 1) |
| 1只股票_1年 | 0.643 | 203.42 | (244, 1) |
| 10只股票_1天 | 0.006 | 0.56 | (1, 10) |
| 10只股票_1个月 | 0.117 | 78.17 | (19, 10) |
| 10只股票_1年 | 0.644 | 203.51 | (244, 10) |
| 100只股票_1天 | 0.007 | 0.56 | (1, 100) |
| 100只股票_1个月 | 0.122 | 79.16 | (19, 100) |
| 100只股票_1年 | 0.609 | 205.27 | (244, 100) |
| 1000只股票_1天 | 0.007 | 0.60 | (1, 1000) |
| 1000只股票_1个月 | 0.140 | 89.18 | (19, 1000) |
| 1000只股票_1年 | 0.713 | 223.21 | (244, 1000) |
| 5000只股票_1天 | 0.010 | 1.13 | (1, 5000) |
| 5000只股票_1个月 | 0.214 | 138.91 | (19, 5000) |
| 5000只股票_1年 | 0.933 | 302.61 | (244, 5000) |

### 6.3 性能分析

1. **时间性能**：
   - 单日查询：< 0.01 秒
   - 月度查询：0.1 - 0.2 秒
   - 年度查询：0.6 - 0.9 秒

2. **内存占用**：
   - 与股票数量和日期范围成正比
   - 1年全量数据约 300 MB 峰值

3. **扩展性**：
   - 股票数量增加对耗时影响较小
   - 日期范围是主要性能瓶颈
